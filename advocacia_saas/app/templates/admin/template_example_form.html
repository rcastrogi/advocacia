{% extends "admin/base_admin.html" %}

{% block title %}{{ 'Editar' if example else 'Novo' }} Exemplo de Template - Admin{% endblock %}

{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item"><a href="{{ url_for('admin.petition_template_examples_list') }}">Exemplos</a></li>
                <li class="breadcrumb-item active">{{ 'Editar' if example else 'Novo' }}</li>
            </ol>
        </nav>
        <h1 class="h3 mb-0">
            <i class="fas fa-{{ 'edit' if example else 'plus' }} me-2"></i>{{ 'Editar' if example else 'Novo' }} Exemplo de Template
        </h1>
    </div>
    <div>
        <a href="{{ url_for('admin.petition_template_examples_list') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>Voltar
        </a>
    </div>
</div>

<form method="POST" id="example-form">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Informações Básicas</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="name" class="form-label">Nome do Exemplo <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="name" name="name" required
                               value="{{ example.name if example else '' }}"
                               placeholder="Ex: Petição Inicial Trabalhista - Modelo Padrão">
                        <div class="form-text">Nome descritivo para identificar este exemplo</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Descrição</label>
                        <textarea class="form-control" id="description" name="description" rows="2"
                                  placeholder="Descrição breve do exemplo e quando usá-lo">{{ example.description if example else '' }}</textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="petition_type_id" class="form-label">Tipo de Petição</label>
                                <select class="form-select" id="petition_type_id" name="petition_type_id">
                                    <option value="">Geral (qualquer tipo)</option>
                                    {% for pt in petition_types %}
                                    <option value="{{ pt.id }}" {% if example and example.petition_type_id == pt.id %}selected{% endif %}>
                                        {{ pt.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">Se especificado, este exemplo será usado apenas para este tipo</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="quality_score" class="form-label">Qualidade</label>
                                <select class="form-select" id="quality_score" name="quality_score">
                                    <option value="5" {% if example and example.quality_score == 5 %}selected{% endif %}>⭐⭐⭐⭐⭐ Excelente</option>
                                    <option value="4" {% if example and example.quality_score == 4 %}selected{% endif %}>⭐⭐⭐⭐ Muito Bom</option>
                                    <option value="3" {% if example and example.quality_score == 3 %}selected{% endif %}>⭐⭐⭐ Bom</option>
                                    <option value="2" {% if example and example.quality_score == 2 %}selected{% endif %}>⭐⭐ Regular</option>
                                    <option value="1" {% if example and example.quality_score == 1 %}selected{% endif %}>⭐ Básico</option>
                                </select>
                                <div class="form-text">Exemplos com maior qualidade têm prioridade</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="tags" class="form-label">Tags</label>
                        <input type="text" class="form-control" id="tags" name="tags"
                               value="{{ example.tags if example else '' }}"
                               placeholder="trabalhista, formal, detalhado">
                        <div class="form-text">Palavras-chave separadas por vírgula</div>
                    </div>
                </div>
            </div>
            
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Conteúdo do Template</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="template_content" class="form-label">Template <span class="text-danger">*</span></label>
                        <textarea class="form-control font-monospace" id="template_content" name="template_content" 
                                  rows="20" required
                                  placeholder="Cole aqui o conteúdo do template exemplar...">{{ example.template_content if example else '' }}</textarea>
                        <div class="form-text">
                            Use placeholders como <code>{{ '{{ cliente.nome }}' }}</code>, <code>{{ '{{ processo.numero }}' }}</code>, etc.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Dicas</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-3">
                        <h6><i class="fas fa-info-circle me-1"></i>O que é um bom exemplo?</h6>
                        <ul class="mb-0 small">
                            <li>Formatação profissional consistente</li>
                            <li>Uso correto de placeholders</li>
                            <li>Estrutura clara e organizada</li>
                            <li>Linguagem jurídica adequada</li>
                            <li>Argumentação bem desenvolvida</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-warning mb-0">
                        <h6><i class="fas fa-star me-1"></i>Como a IA usa exemplos</h6>
                        <p class="mb-0 small">
                            A IA analisa a estrutura, estilo e formatação dos exemplos 
                            para gerar templates similares. Quanto melhor o exemplo, 
                            melhor será a geração.
                        </p>
                    </div>
                </div>
            </div>
            
            {% if example %}
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Estatísticas</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Vezes usado:</span>
                        <strong>{{ example.usage_count or 0 }}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span class="text-muted">Criado em:</span>
                        <strong>{{ example.created_at.strftime('%d/%m/%Y') if example.created_at else '-' }}</strong>
                    </div>
                    {% if example.updated_at %}
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">Atualizado em:</span>
                        <strong>{{ example.updated_at.strftime('%d/%m/%Y') }}</strong>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save me-1"></i>{{ 'Salvar Alterações' if example else 'Criar Exemplo' }}
                </button>
                <a href="{{ url_for('admin.petition_template_examples_list') }}" class="btn btn-outline-secondary">
                    Cancelar
                </a>
            </div>
        </div>
    </div>
</form>
{% endblock %}
