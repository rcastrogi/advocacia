{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-1">
                <i class="fas fa-comment-dots"></i> 
                {{ 'Editar Depoimento' if testimonial else 'Enviar Depoimento' }}
            </h1>
            <p class="text-muted mb-0">Compartilhe sua experiência com o Petitio.</p>
        </div>
        <div class="d-flex flex-wrap gap-2 align-items-center">
            <a href="{{ url_for('main.testimonials') }}" class="btn btn-sm btn-outline-secondary d-flex align-items-center">
                <i class="fas fa-arrow-left me-1"></i> Voltar
            </a>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <strong><i class="fas fa-pen me-1"></i> Seu Depoimento</strong>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-info-circle me-1"></i>
                        <strong>Importante:</strong> Seu depoimento passará por uma revisão antes de ser publicado na página inicial. 
                        Certifique-se de que o conteúdo é apropriado e representa sua experiência real com a plataforma.
                    </div>
                    
                    <form method="post">
                        {{ form.hidden_tag() }}
                        
                        <div class="mb-3">
                            {{ form.content.label(class_='form-label') }}
                            {{ form.content(class_='form-control') }}
                            <small class="text-muted">Mínimo 50 caracteres, máximo 1000.</small>
                            {% if form.content.errors %}
                            <div class="text-danger small">{{ form.content.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            {{ form.rating.label(class_='form-label') }}
                            {{ form.rating(class_='form-select') }}
                        </div>
                        
                        <hr class="my-4">
                        <h6 class="text-muted mb-3"><i class="fas fa-user me-1"></i> Como você quer ser identificado?</h6>
                        
                        <div class="mb-3">
                            {{ form.display_name.label(class_='form-label') }}
                            {{ form.display_name(class_='form-control') }}
                            {% if form.display_name.errors %}
                            <div class="text-danger small">{{ form.display_name.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                {{ form.display_role.label(class_='form-label') }}
                                {{ form.display_role(class_='form-control') }}
                            </div>
                            <div class="col-md-6">
                                {{ form.display_location.label(class_='form-label') }}
                                {{ form.display_location(class_='form-control') }}
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-1"></i> 
                                {{ 'Atualizar Depoimento' if testimonial else 'Enviar Depoimento' }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Preview Card -->
            <div class="card shadow-sm mt-4">
                <div class="card-header">
                    <strong><i class="fas fa-eye me-1"></i> Prévia do Depoimento</strong>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">Assim será exibido na página inicial após aprovação:</p>
                    
                    <div class="border rounded p-3 bg-light">
                        <div class="d-flex align-items-start">
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3" 
                                 style="width: 50px; height: 50px; font-size: 1.2rem;" id="preview-avatar">
                                ?
                            </div>
                            <div class="flex-grow-1">
                                <div class="mb-1" id="preview-stars">
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                </div>
                                <p class="mb-2 fst-italic" id="preview-content">"Seu depoimento aparecerá aqui..."</p>
                                <div>
                                    <strong id="preview-name">Seu Nome</strong>
                                    <span class="text-muted" id="preview-role"></span>
                                </div>
                                <small class="text-muted" id="preview-location"></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentField = document.getElementById('content');
    const ratingField = document.getElementById('rating');
    const nameField = document.getElementById('display_name');
    const roleField = document.getElementById('display_role');
    const locationField = document.getElementById('display_location');
    
    const previewContent = document.getElementById('preview-content');
    const previewStars = document.getElementById('preview-stars');
    const previewName = document.getElementById('preview-name');
    const previewRole = document.getElementById('preview-role');
    const previewLocation = document.getElementById('preview-location');
    const previewAvatar = document.getElementById('preview-avatar');
    
    function updatePreview() {
        // Content
        const content = contentField.value.trim();
        previewContent.textContent = content ? `"${content}"` : '"Seu depoimento aparecerá aqui..."';
        
        // Rating
        const rating = parseInt(ratingField.value) || 5;
        let starsHtml = '';
        for (let i = 0; i < 5; i++) {
            if (i < rating) {
                starsHtml += '<i class="fas fa-star text-warning"></i>';
            } else {
                starsHtml += '<i class="far fa-star text-muted"></i>';
            }
        }
        previewStars.innerHTML = starsHtml;
        
        // Name
        const name = nameField.value.trim();
        previewName.textContent = name || 'Seu Nome';
        previewAvatar.textContent = name ? name.charAt(0).toUpperCase() : '?';
        
        // Role
        const role = roleField.value.trim();
        previewRole.textContent = role ? ` · ${role}` : '';
        
        // Location
        const location = locationField.value.trim();
        previewLocation.innerHTML = location ? `<i class="fas fa-map-marker-alt me-1"></i>${location}` : '';
    }
    
    // Update preview on input
    [contentField, ratingField, nameField, roleField, locationField].forEach(field => {
        if (field) {
            field.addEventListener('input', updatePreview);
            field.addEventListener('change', updatePreview);
        }
    });
    
    // Initial update
    updatePreview();
});
</script>
{% endblock %}
